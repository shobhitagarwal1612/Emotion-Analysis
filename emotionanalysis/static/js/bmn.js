function serialize(mixed_value){var val,key,okey,ktype='',vals='',count=0,_utf8Size=function(str){var size=0,i=0,l=str.length,code='';for(i=0;i<l;i++){code=str.charCodeAt(i);if(code<0x0080){size+=1;}
else if(code<0x0800){size+=2;}
else{size+=3;}}
return size;},_getType=function(inp){var match,key,cons,types,type=typeof inp;if(type==='object'&&!inp){return'null';}
if(type==='object'){if(!inp.constructor){return'object';}
cons=inp.constructor.toString();match=cons.match(/(\w+)\(/);if(match){cons=match[1].toLowerCase();}
types=['boolean','number','string','array'];for(key in types){if(cons==types[key]){type=types[key];break;}}}
return type;},type=_getType(mixed_value);switch(type){case'function':val='';break;case'boolean':val='b:'+(mixed_value?'1':'0');break;case'number':val=(Math.round(mixed_value)==mixed_value?'i':'d')+':'+ mixed_value;break;case'string':val='s:'+ _utf8Size(mixed_value)+':"'+ mixed_value+'"';break;case'array':case'object':val='a';for(key in mixed_value){if(mixed_value.hasOwnProperty(key)){ktype=_getType(mixed_value[key]);if(ktype==='function'){continue;}
okey=(key.match(/^[0-9]+$/)?parseInt(key,10):key);vals+=this.serialize(okey)+ this.serialize(mixed_value[key]);count++;}}
val+=':'+ count+':{'+ vals+'}';break;case'undefined':default:val='N';break;}
if(type!=='object'&&type!=='array'){val+=';';}
return val;}
function unserialize(data){var that=this,utf8Overhead=function(chr){var code=chr.charCodeAt(0);if(code<0x0080){return 0;}
if(code<0x0800){return 1;}
return 2;},error=function(type,msg,filename,line){throw new that.window[type](msg,filename,line);},read_until=function(data,offset,stopchr){var i=2,buf=[],chr=data.slice(offset,offset+ 1);while(chr!=stopchr){if((i+ offset)>data.length){error('Error','Invalid');}
buf.push(chr);chr=data.slice(offset+(i- 1),offset+ i);i+=1;}
return[buf.length,buf.join('')];},read_chrs=function(data,offset,length){var i,chr,buf;buf=[];for(i=0;i<length;i++){chr=data.slice(offset+(i- 1),offset+ i);buf.push(chr);length-=utf8Overhead(chr);}
return[buf.length,buf.join('')];},_unserialize=function(data,offset){var dtype,dataoffset,keyandchrs,keys,readdata,readData,ccount,stringlength,i,key,kprops,kchrs,vprops,vchrs,value,chrs=0,typeconvert=function(x){return x;};if(!offset){offset=0;}
dtype=(data.slice(offset,offset+ 1)).toLowerCase();dataoffset=offset+ 2;switch(dtype){case'i':typeconvert=function(x){return parseInt(x,10);};readData=read_until(data,dataoffset,';');chrs=readData[0];readdata=readData[1];dataoffset+=chrs+ 1;break;case'b':typeconvert=function(x){return parseInt(x,10)!==0;};readData=read_until(data,dataoffset,';');chrs=readData[0];readdata=readData[1];dataoffset+=chrs+ 1;break;case'd':typeconvert=function(x){return parseFloat(x);};readData=read_until(data,dataoffset,';');chrs=readData[0];readdata=readData[1];dataoffset+=chrs+ 1;break;case'n':readdata=null;break;case's':ccount=read_until(data,dataoffset,':');chrs=ccount[0];stringlength=ccount[1];dataoffset+=chrs+ 2;readData=read_chrs(data,dataoffset+ 1,parseInt(stringlength,10));chrs=readData[0];readdata=readData[1];dataoffset+=chrs+ 2;if(chrs!=parseInt(stringlength,10)&&chrs!=readdata.length){error('SyntaxError','String length mismatch');}
break;case'a':readdata={};keyandchrs=read_until(data,dataoffset,':');chrs=keyandchrs[0];keys=keyandchrs[1];dataoffset+=chrs+ 2;for(i=0;i<parseInt(keys,10);i++){kprops=_unserialize(data,dataoffset);kchrs=kprops[1];key=kprops[2];dataoffset+=kchrs;vprops=_unserialize(data,dataoffset);vchrs=vprops[1];value=vprops[2];dataoffset+=vchrs;readdata[key]=value;}
dataoffset+=1;break;default:error('SyntaxError','Unknown / Unhandled data type(s): '+ dtype);break;}
return[dtype,dataoffset- offset,typeconvert(readdata)];};return _unserialize((data+''),0)[2];}
function parseUri(str){var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function isValidDomain(domain){var re=new RegExp(/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/);return domain.match(re);}
function extractDomain(str){str=str.toLowerCase();if(str){var domain=parseUri(str).host;if(domain.substring(0,4)=='www.')domain=domain.substring(4);if(isValidDomain(domain)){return domain;}else{return false;}}else{return false;}}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+ date.toGMTString();}else var expires="";document.cookie=escape(name)+"="+ escape(value)+ expires+"; path=/";}
function readCookie(name){var nameEQ=escape(name)+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return unescape(c.substring(nameEQ.length,c.length));}
return null;}
$.fn.autoSelect=function(){var selectTarget=this[0];if(selectTarget!=null){if(selectTarget.tagName=='TEXTAREA'||(selectTarget.tagName=="INPUT"&&selectTarget.type=="text")){selectTarget.select();}else if(window.getSelection){var sel=window.getSelection();var range=document.createRange();range.selectNode(selectTarget);sel.removeAllRanges();sel.addRange(range);}else{document.selection.empty();var range=document.body.createTextRange();range.moveToElementText(selectTarget);range.select();};};return this;};$.fn.serializeForm=function(){data={};url=this.attr("action");items=this.serializeArray();$.each(items,function(i,item){data[item['name']]=item['value'];});return data;}
function submitForm(form,callback){items={};items=$(form).serializeForm();url=$(form).attr("action");if(""==url){alert("Cannot submit form. No action specified");return false;}
callback=callback?callback:function(){};$.post(url,items,callback);return false;}
$(function(){$('.search_form').submit(function(){var domain=extractDomain($(this).children('#search_query').val());if(domain){window.location='/view/'+domain;}else{alert('Invalid domain entered (expecting "example.com")');}
return false;});$("kbd").bind('click',function(){$("kbd").removeClass("selected");$(this).autoSelect().addClass("selected");});$('article.account').css('transition','.6s');$('article.account form').submit(function(e){e.preventDefault();});$("button.vote_yes").bind('click',function(){var form=$(this).closest('form');$(this).css('opacity',1);form.closest('article.account').css('backgroundColor','#354637');form.find('input[name=vote]').val('Y');submitForm(form);var voteLog=new Array();var cookie=unserialize(readCookie('voteLog'));if(cookie)voteLog=cookie;voteLog[form.find('input[name=account]').val()]='Y';createCookie('voteLog',serialize(voteLog),120);});$("button.vote_no").bind('click',function(){var form=$(this).closest('form');$(this).css('opacity',1);form.closest('article.account').css('backgroundColor','#4E3437').delay(400).css('transition','none').slideUp(500);form.find('input[name=vote]').val('N');submitForm(form);var voteLog=new Array();var cookie=unserialize(readCookie('voteLog'));if(cookie)voteLog=cookie;voteLog[form.find('input[name=account]').val()]='N';createCookie('voteLog',serialize(voteLog),120);});var voteLog=unserialize(readCookie('voteLog'));if(voteLog){$.each(voteLog,function(accountId,vote){var accountDiv=$('[data-account_id="'+accountId+'"]');if(accountDiv){if(vote=='Y'){accountDiv.css('backgroundColor','#354637');}else{accountDiv.css('backgroundColor','#4E3437').delay(400).css('transition','none').slideUp(500);}}});}});